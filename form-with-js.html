<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>form-no-js</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                display: flex;
                justify-content: center; 
                align-items: flex-start; 
                padding: 2rem;
            }

            form {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                width: 100%;
                max-width: 400px;
            }

            label {
                font-weight: bold;
                margin-bottom: 0.2rem;
            }

            input[type="text"], input[type="email"], input[list], textarea {
                padding: 0.5rem;
                font-size: 1rem;
                border: 1px solid #ccc;
                border-radius: 3px;
                width: 100%;
            }

            input[type="submit"] {
                padding: 0.5rem;
                font-size: 1rem;
                cursor: pointer;
                width: 105%;
            }

            output {
                font-size: 0.9rem;
                min-height: 1.2em;
            }

            output#error {
                color: red;
            }

            output#info {
                color: orange;
            } 

        </style>

        <script>
        const form_errors = [];

        function loadHandler() {
            nameValidation();
            emailValidation();
            reasonValidation();
            messageValidation();

            maskInvalidChars(document.getElementById("name"), /[A-Za-z0-9\s]/);
            maskInvalidChars(document.getElementById("reason"), /[A-Za-z0-9\s]/);
            maskInvalidChars(document.getElementById("email"), /[A-Za-z0-9@._-]/);

            setupCharCounter();
            setupFormErrorCapture();
        }

        function nameValidation () {
            const name = document.getElementById("name");
            const info = document.getElementById("info");

            name.addEventListener("input", () => {
                name.setCustomValidity("");
                if (!name.checkValidity()) {
                    showNameError();
                } else {
                    info.textContent = "";
                }
            });
        }

        function showNameError () {
            const name = document.getElementById("name");
            const info = document.getElementById("info");
            let infomsg;

            if (name.validity.tooShort) {
                infomsg = "Name must be at least 2 characters.";
            } else if (name.validity.patternMismatch) {
                infomsg = "Only alphanumeric characters allowed.";
            } else if (name.validity.valueMissing) {
                infomsg = "Name is required.";
            }

            name.setCustomValidity(infomsg);
            info.textContent = infomsg;

            form_errors.push({
                field: "name",
                value: name.value,
                error: infomsg,
            });
        }

        function emailValidation() {
            const email = document.getElementById("email");
            const info = document.getElementById("info");

            email.addEventListener("input", () => {
                email.setCustomValidity("");
                if (!email.checkValidity()) {
                    showEmailError();
                } else {
                    info.textContent = "";
                }
            });
        }

        function showEmailError() {
            const email = document.getElementById("email");
            const info = document.getElementById("info");
            let infomsg;

            if (email.validity.tooShort) {
                infomsg = "Email must be at least 2 characters.";
            } else if (email.validity.patternMismatch) {
                infomsg = "Email must contain @ and a domain.";
            } else if (email.validity.valueMissing) {
                infomsg = "Email is required.";
            }

            email.setCustomValidity(infomsg);
            info.textContent = infomsg;

            form_errors.push({
                field: "email",
                value: email.value,
                error: infomsg,
            });
        }


        function reasonValidation() {
            const reason = document.getElementById("reason");
            const info = document.getElementById("info");

            reason.addEventListener("input", () => {
                reason.setCustomValidity("");
                if (!reason.checkValidity()) {
                    showReasonError();
                } else {
                    info.textContent = "";
                }
            });
        }

        function showReasonError() {
            const reason = document.getElementById("reason");
            const info = document.getElementById("info");
            let infomsg;

            if (reason.validity.tooShort) {
                infomsg = "Reason must be at least 2 characters.";
            } else if (reason.validity.patternMismatch) {
                infomsg = "Only alphanumeric characters allowed.";
            } else if (reason.validity.valueMissing) {
                infomsg = "Reason is required.";
            }

            reason.setCustomValidity(infomsg);
            info.textContent = infomsg;

            form_errors.push({
                field: "reason",
                value: reason.value,
                error: infomsg,
            });
        }


        function messageValidation() {
            const message = document.getElementById("message");
            const info = document.getElementById("info");

            message.addEventListener("input", () => {
                message.setCustomValidity("");
                if (!message.checkValidity()) {
                    showMessageError();
                } else {
                    info.textContent = "";
                }
            });
        }

        function showMessageError() {
            const message = document.getElementById("message");
            const info = document.getElementById("info");
            let infomsg;

            if (message.validity.tooShort) {
                infomsg = "Message must be at least 5 characters.";
            } else if (message.validity.valueMissing) {
                infomsg = "Message is required.";
            }

            message.setCustomValidity(infomsg);
            info.textContent = infomsg;

            form_errors.push({
                field: "message",
                value: message.value,
                error: infomsg,
            });
        }


        function setupCharCounter() {
            const message = document.getElementById("message");
            const counter = document.getElementById("charCount");
            const max = message.maxLength; 
            message.addEventListener("input", () => {
                const len = message.value.length;
                counter.textContent = `${len} / ${max}`;
                if (len > max) {
                    message.value = message.value.slice(0, max);
                    return; 
                }
                counter.style.color = "gray";
                if (len >= max * 0.8 && len < max) {
                    counter.style.color = "orange";
                } else if (len >= max) {
                    counter.style.color = "red";
                    message.style.backgroundColor = "#f8d7da";
                    const info = document.getElementById("info");
                    info.textContent = "Message exceeded maximum allowed characters.";
                    form_errors.push({
                        field: "message",
                        value: message.value,
                        error: "Exceeded maximum characters",
                    });
                    setTimeout(() => {
                        message.style.backgroundColor = "";
                        info.textContent = "";
                    }, 2000);
                    message.setCustomValidity("Message exceeded maximum allowed characters.");
                }
            });
        }

        function maskInvalidChars(field, pattern) {
            const error = document.getElementById("error");
            field.addEventListener("input", () => {
                const value = field.value;
                const lastChar = value.slice(-1);
                if (!lastChar) return; 
                if (!pattern.test(lastChar)) {
                    field.style.backgroundColor = "#f8d7da";
                    setTimeout(() => field.style.backgroundColor = "", 350);
                    error.textContent = `Illegal character typed in ${field.name}`;
                    setTimeout(() => {
                        error.textContent = "";
                    }, 2000);
                }
            });
        }

        function setupFormErrorCapture() {
            const form = document.getElementById("contactform");
            form.addEventListener("submit", (event) => {
                document.getElementById("form_errors").value = JSON.stringify(form_errors);
            });
        }

        window.addEventListener("DOMContentLoaded", loadHandler); 
        </script>
    </head>

    <body>
        <form id="contactform" action="https://httpbin.org/post" method="post">
             <label for="name">Name:</label>
            <input type="text" name="name" id="name" placeholder="Name" 
            minlength="2" maxlength="50" pattern="[A-Za-z0-9\s]+" required>
            <label for="email">Email:</label>
            <input type="email" name="email" id="email" placeholder="Email" 
            minlength="2" maxlength="50" pattern="[^@\s]+@[^@\s]+\.[^@\s]+" required>
            <label for="reason">Reason for contact:</label>
            <input type="text" name="reason" id="reason" list="reasonsuggestions" placeholder="Reason" 
            minlength="2" maxlength="50" pattern="[A-Za-z0-9\s]+" required>
            <datalist id="reasonsuggestions">
                <option value="Question">
                <option value="Comment">
                <option value="Want to Connect">
            </datalist>
            <label for="message">Message:</label>
            <textarea name="message" id="message" rows="5" placeholder="Message"
            minlength="5" maxlength="500" required></textarea>
            <div id="charCount" style="font-size: 0.9rem; color: gray;">
                0 / 500
            </div>
            <input type="hidden" name="possible_bot" value="true">
            <input type="hidden" name="form-errors" id="form_errors" value="">
            <input type="submit" value="Submit">
            <output id="error" name="error"></output>
            <output id="info" name="info"></output>
        </form>
    </body>
</html>
